ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

= Deploying a S3 for Youse`s challenge.
:toc:

== Getting started 

=== About the project

This project uses Terraform for creating resources in AWS. Those resources are used for deploying S3 for Youse challenge ans Helm to deploy the oplication on Kubernets.

=== Install AWS CLI and Configure AWS Credentials 

Install AWS CLI according to your operating system using this https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html[link].

If you don't have an IAM user follow *step A*, otherwise if you need to create only access keys for an existing user follow *step B*.

.A. Creating an IAM user and access keys 
[%collapsible]
====

*	Sign in to the AWS Management Console and open the https://console.aws.amazon.com/iam/[IAM console].
*	In the navigation pane, choose *Users* and then choose *Add* user.
*	Type the user name for the new user, select *Programmatic access* and *AWS Management Console access* 
**	For *Console password*, choose *Autogenerated password*. You can view or download the passwords when you get to the Final page.
**	Select *Require password reset*.
**	Click *Next: Require password reset*.
*	Select *Attach existing policies directly*, choose *AdministratorAccess*,
*	Click *Next: Tags*, *Next: Review* and *Create User*.
*	To view the users' *access keys* (access key IDs and secret access keys), choose *Show* next to each password and access key that you want to see. To save the access keys, choose *Download .csv* and then save the file to a safe location.

====


.B. Creating access keys for an existing IAM user
[%collapsible]
====

*	Sign in to the AWS Management Console and open the https://console.aws.amazon.com/iam/[IAM console].
*	In the navigation pane, choose *Users* and then choose the  existing user you want to create the access keys.
*	Under the *Security credentials* pane, in the section *Access keys* click *Create access key*
*	Type the user name for the new user, select *Programmatic access* and *AWS Management Console access* 
*	To view the users' *access keys* (access key IDs and secret access keys), choose *Show* next to *Secret access key*. To save the access key, choose *Download .csv* and then save the file to a safe location.

====

After installing AWS CLI and getting your access keys run this command to quickly set your AWS credentials, region and output format (default:json)
 
	$ aws configure

=== Install Terraform (this project uses Terraform 0.14)

 	$ brew install terraform
	

=== Deploying S3 challenge
[%collapsible]
====
Firstly on the S3 in the chosen region, you need to create the bucket "youse" to save the terraform status.

After that, you will be able to create the S3. 
Get into the dir youse/infra and run the commands below:

	terraform init
	terraform apply

If everything got OK you will receive the following output:

	Apply complete! Resources: 6 added, 0 changed, 0 destroyed.
	Outputs:
	provision_daily_arn = "arn:aws:s3:::youse-s3-daily20210223193235797000000002"
	provision_daily_id = "youse-s3-daily20210223193235797000000002"
	provision_hourly_arn = "arn:aws:s3:::youse-s3-hourly20210223193235796700000001"
	provision_hourly_id = "youse-s3-hourly20210223193235796700000001"
	provision_weekly_arn = "arn:aws:s3:::youse-s3-weekly20210223193235839100000003"
	provision_weekly_id = "youse-s3-weekly20210223193235839100000003"

====

=== Deploying challenge APP 
[%collapsible]
====
Now that you already have the infrastructure deployed for the application you can deploy the APP indeed.

We are starting from the idea that you already have the kubectl and helm installed and configured.

That said, you just need to get into the base dir on the project and execute the command below:
  helm install challenge-chart deploy/ --values deploy/values.yaml 

====
